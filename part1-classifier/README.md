# Часть 1: Промпт-классификатор математических ошибок

## Описание

Автоматический классификатор для проверки математической корректности ответов ИИ-репетитора. Использует Claude Sonnet 4.5 для анализа диалогов и определения, содержит ли последняя реплика ИИ математические ошибки.

## Модель

**Claude Sonnet 4.5** (claude-sonnet-4-5-20250929)

Выбор обоснован:
- Отличное понимание математического контекста
- Высокая точность логических рассуждений
- Надежное следование инструкциям в промпте
- Поддержка structured output (JSON)

## Структура файлов

```
part1-classifier/
├── prompt.md           # Полный текст промпта для классификации
├── classifier.py       # Python скрипт для автоматической классификации
├── analysis.md         # Анализ сложных случаев и рекомендации
├── requirements.txt    # Зависимости Python
└── README.md          # Этот файл
```

## Установка

```bash
pip install -r requirements.txt
```

Установите переменную окружения с API ключом:
```bash
export ANTHROPIC_API_KEY="your-api-key"
```

## Использование

### Базовое использование

```python
from classifier import MathErrorClassifier

# Инициализация
classifier = MathErrorClassifier()

# Классификация одного примера
result = classifier.classify(
    task_text="Вычислите площадь круга радиусом 5",
    dialogue_history="Ученик: Как найти площадь круга?",
    ai_response="S = πr² = 3.14 × 5² = 78.5"
)

print(f"Оценка: {result['assessment']}")  # 0 или 1
print(f"Объяснение: {result['reasoning']}")
```

### Пакетная обработка

```python
examples = [
    {
        "id": 1,
        "task_text": "...",
        "dialogue_history": "...",
        "ai_response": "..."
    },
    # ... больше примеров
]

results = classifier.classify_batch(examples)
```

### Расчет метрик

```python
from classifier import calculate_metrics

predictions = [0, 1, 0, 1, 1]
ground_truth = [0, 1, 1, 1, 0]

metrics = calculate_metrics(predictions, ground_truth)
print(f"Accuracy: {metrics['accuracy']:.2%}")
print(f"Precision: {metrics['precision']:.2%}")
print(f"Recall: {metrics['recall']:.2%}")
print(f"F1-Score: {metrics['f1_score']:.2%}")
```

## Формат ответа

Классификатор возвращает JSON:

```json
{
  "assessment": 0,
  "reasoning": "ИИ просто задает наводящий вопрос ученику, не делая собственных вычислений",
  "error_type": null
}
```

Где:
- `assessment`: 0 (нет ошибки) или 1 (есть ошибка)
- `reasoning`: Объяснение решения (2-3 предложения)
- `error_type`: Тип ошибки (вычислительная/формула/логическая/определение) или null

## Критерии классификации

### ОШИБКА (1)

Ставится только если ИИ-репетитор:
- ✗ Самостоятельно выполняет неверное вычисление
- ✗ Дает неверную формулу или определение
- ✗ Делает ошибочное преобразование выражения
- ✗ Совершает логическую ошибку в рассуждениях
- ✗ Утверждает неверный математический факт

### НЕ ОШИБКА (0)

Ставится если ИИ-репетитор:
- ✓ Просто оценивает ответ ученика (даже если оценка неточная)
- ✓ Задает наводящие вопросы
- ✓ Повторяет неверный результат из предыдущих реплик БЕЗ собственных вычислений
- ✓ Дает общие указания без конкретных неверных действий
- ✓ Делает опечатку в словах (не в числах/формулах)

## Примеры

### Пример 1: ОШИБКА

**Вход**:
```
Ученик: "Производная x² равна?"
ИИ: "Производная x² равна x"
```

**Выход**:
```json
{
  "assessment": 1,
  "reasoning": "ИИ дал неверную формулу производной. Правильный ответ: 2x",
  "error_type": "формула"
}
```

### Пример 2: НЕ ОШИБКА

**Вход**:
```
Ученик: "Я получил 75"
ИИ: "Хорошо! Теперь используй это значение в следующем шаге"
```

**Выход**:
```json
{
  "assessment": 0,
  "reasoning": "ИИ не выполняет собственных вычислений, только дает указание ученику",
  "error_type": null
}
```

## Метрики качества

На тестовой выборке (примеры 1-45):

- **Accuracy**: точность классификации
- **Precision**: доля правильных среди помеченных как ошибки
- **Recall**: доля найденных ошибок среди всех реальных ошибок
- **F1-Score**: гармоническое среднее Precision и Recall
- **Confusion Matrix**: матрица ошибок (TP, TN, FP, FN)

## Сложные случаи

Подробный анализ сложных для классификации случаев и рекомендации по улучшению промпта см. в [analysis.md](analysis.md).

### Самые сложные категории:

1. **Косвенное подтверждение** неверного ответа
2. **Опечатки** vs реальные ошибки
3. **Педагогические упрощения** vs ошибки
4. **Ошибки в середине** длинной цепочки рассуждений

## Ограничения

- Требует API ключ Anthropic
- Стоимость: ~$0.003 per classification (при использовании Sonnet 4.5)
- Время обработки: ~1-3 сек на пример
- Не гарантирует 100% точность на граничных случаях

## Дальнейшее развитие

См. раздел "План дальнейшего развития" в [analysis.md](analysis.md).

---

**Автор**: TimXa
**Дата**: Февраль 2026
**Версия**: 1.0
